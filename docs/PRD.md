# Product Requirements Document
## Telegram Text-to-Speech Bot

**Version:** 1.0 (MVP)  
**Date:** December 2025  
**Status:** Draft

---

## 1. Executive Summary

A Telegram bot that converts text input into natural-sounding speech audio files. Users send text messages or markdown files, and receive MP3 audio files generated by Google's Gemini 2.5 Flash TTS model. The bot is stateless, free to use, and designed for simplicity.

**Value Proposition:** Instant, high-quality text-to-speech conversion directly in Telegram without requiring any external apps, accounts, or technical knowledge.

---

## 2. Problem Statement

Users need a simple way to convert text to speech for various purposes: accessibility, content creation, language learning, or convenience. Existing solutions require installing apps, creating accounts, navigating complex interfaces, or paying subscriptions.

**Target Users:** Anyone who needs quick TTS conversionâ€”content creators, students, professionals preparing presentations, language learners, or users with accessibility needs.

---

## 3. Goals & Success Metrics

### Primary Goals
- Deliver working MVP within 1-2 weeks
- Process text-to-speech requests with <30 second response time
- Support English, Russian, and German languages

### Success Metrics
| Metric | Target |
|--------|--------|
| Successful conversion rate | >95% |
| Average response time | <20 seconds for typical requests |
| Bot uptime | >99% |

---

## 4. Product Overview

### Core Flow
```
User sends text/file â†’ Bot extracts text â†’ Gemini TTS generates audio â†’ Bot sends MP3
```

### Input Types
1. **Text messages** â€” User types or pastes text directly in chat
2. **Markdown files (.md)** â€” User uploads file, bot reads as plain text

### Output
- MP3 audio file sent back to user in Telegram

---

## 5. Functional Requirements

### FR-1: Text Message Processing
| ID | Requirement | Priority |
|----|-------------|----------|
| FR-1.1 | Bot receives text messages up to 20,000 characters | Must |
| FR-1.2 | Bot validates text length before processing | Must |
| FR-1.3 | Bot sends "processing" indicator while generating | Should |
| FR-1.4 | Bot handles empty/whitespace-only messages gracefully | Must |

### FR-2: Markdown File Processing  
| ID | Requirement | Priority |
|----|-------------|----------|
| FR-2.1 | Bot accepts .md file uploads | Must |
| FR-2.2 | Bot reads file content as plain text (no parsing) | Must |
| FR-2.3 | Bot enforces 20,000 character limit on file content | Must |
| FR-2.4 | Bot rejects non-.md files with helpful message | Should |

### FR-3: TTS Generation
| ID | Requirement | Priority |
|----|-------------|----------|
| FR-3.1 | Bot sends text to Gemini 2.5 Flash TTS API | Must |
| FR-3.2 | Bot uses female voice (Kore) | Must |
| FR-3.3 | Bot auto-detects language (EN/RU/DE) | Must |
| FR-3.4 | Bot converts PCM output to MP3 format | Must |
| FR-3.5 | Bot sends MP3 file to user | Must |

### FR-4: User Commands
| ID | Requirement | Priority |
|----|-------------|----------|
| FR-4.1 | `/start` â€” Welcome message with usage instructions | Must |
| FR-4.2 | `/help` â€” Show supported formats and limits | Must |

### FR-5: Error Handling
| ID | Requirement | Priority |
|----|-------------|----------|
| FR-5.1 | Bot handles rate limit errors (429) with retry | Must |
| FR-5.2 | Bot informs user of API errors in plain language | Must |
| FR-5.3 | Bot handles network timeouts gracefully | Must |

---

## 6. Non-Functional Requirements

### NFR-1: Performance
- Response time: <30 seconds for 5,000 characters
- Concurrent users: Handle 10+ simultaneous requests

### NFR-2: Reliability
- Uptime target: 99%
- Automatic restart on crash (Railway handles this)

### NFR-3: Security
- API keys stored as environment variables
- No user data stored (stateless)
- No logging of user text content

### NFR-4: Scalability
- Single instance MVP (Railway)
- Async processing for concurrent requests

---

## 7. Technical Architecture

### Stack
| Component | Technology |
|-----------|------------|
| Telegram Bot Framework | aiogram 3.x |
| TTS Model | Gemini 2.5 Flash TTS (`gemini-2.5-flash-preview-tts`) |
| AI Integration | LangChain (`langchain-google-genai`) |
| Audio Conversion | pydub + ffmpeg |
| Deployment | Railway |
| Runtime | Python 3.11+ |

### Architecture Diagram
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Telegram  â”‚â”€â”€â”€â”€â–¶â”‚  aiogram    â”‚â”€â”€â”€â”€â–¶â”‚  LangChain  â”‚â”€â”€â”€â”€â–¶â”‚ Gemini TTS  â”‚
â”‚    User     â”‚â—€â”€â”€â”€â”€â”‚    Bot      â”‚â—€â”€â”€â”€â”€â”‚   Wrapper   â”‚â—€â”€â”€â”€â”€â”‚    API      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   pydub     â”‚
                    â”‚  (WAVâ†’MP3)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Dependencies
- aiogram 3.x
- langchain-google-genai 2.x
- pydub
- python-dotenv

### Environment Variables
- `TELEGRAM_BOT_TOKEN` â€” Telegram bot token from @BotFather
- `GOOGLE_API_KEY` â€” Google AI API key

---

## 8. Technical Implementation Details

### Gemini TTS Constraints
| Constraint | Value |
|------------|-------|
| Max input tokens | 32,000 tokens (~20,000 chars) |
| Max output duration | ~655 seconds (~11 minutes) |
| Output format | PCM 16-bit, 24kHz |
| Rate limits | Varies (may get 429 errors) |

### Supported Languages
Gemini TTS auto-detects language from text. Explicitly supported:
- English (en)
- Russian (ru)  
- German (de)

---

## 9. User Experience

### Welcome Message (`/start`)
Greeting with bot capabilities, supported input types (text up to 20k chars, .md files), supported languages (EN/RU/DE), and pointer to /help.

### Help Message (`/help`)
Detailed usage instructions covering text input, file upload, character limits, voice info (Kore/female), and auto-detected languages.

### Processing Flow
1. User sends text â†’ Bot replies with "ðŸŽ™ Generating audio..." 
2. Bot generates audio (5-30 seconds)
3. Bot sends MP3 file as voice message or audio file

### Error Messages
| Scenario | Message |
|----------|---------|
| Text too long | "âŒ Text too long. Maximum 20,000 characters. Your text: {count} characters." |
| Unsupported file | "âŒ Please send a .md file or text message." |
| API error | "âŒ Couldn't generate audio. Please try again in a moment." |
| Rate limit | "â³ Service busy. Please wait a moment and try again." |

---

---

## 10. Deployment (Railway)

### Configuration
- Use Dockerfile builder
- Install ffmpeg for audio conversion
- Python 3.11+ runtime

### Estimated Costs
| Service | Cost |
|---------|------|
| Railway | ~$5/month (hobby plan) |
| Gemini API | Free tier (15 RPM, 1M TPM) |
| **Total** | **~$5/month** |

---

## 11. Development Milestones

### Phase 1: Core Bot (Days 1-3)
- [ ] Set up aiogram bot skeleton
- [ ] Implement `/start` and `/help` commands
- [ ] Handle text messages

### Phase 2: TTS Integration (Days 4-6)
- [ ] Integrate LangChain + Gemini TTS
- [ ] Implement WAV to MP3 conversion
- [ ] Handle API errors and rate limits

### Phase 3: File Support (Days 7-8)
- [ ] Add .md file upload handling
- [ ] Validate file size/content

### Phase 4: Deploy & Test (Days 9-10)
- [ ] Deploy to Railway
- [ ] End-to-end testing
- [ ] Fix bugs

---

## 12. Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Gemini API rate limits | Users get 429 errors | Implement retry with exponential backoff |
| Long audio generation time | Poor UX | Show processing indicator, set user expectations |
| API changes (preview model) | Bot breaks | Monitor Google announcements, pin version |
| Large text causes timeout | Failed requests | Chunk text if needed, enforce limits |

---

## 13. Assumptions

1. Gemini 2.5 Flash TTS preview remains available and stable
2. Free tier API limits are sufficient for MVP usage
3. Single Railway instance can handle initial user load
4. Users accept auto-detected language (no manual selection)

---

## 14. Out of Scope (Future Enhancements)

- Voice selection (male/female options)
- Manual language selection
- PDF/DOCX file support
- User history/favorites
- Premium features/monetization
- Multi-speaker conversations

---

## 15. Acceptance Criteria

The MVP is complete when:

1. âœ… Bot responds to `/start` and `/help` commands
2. âœ… Bot converts text messages (up to 20k chars) to MP3
3. âœ… Bot converts .md files to MP3
4. âœ… Bot handles errors gracefully with user-friendly messages
5. âœ… Bot is deployed and accessible on Telegram
6. âœ… Response time <30 seconds for typical requests

---

## Appendix A: Gemini TTS Voice Options

For future reference, female voices available:
- **Kore** (recommended) â€” Clear, natural
- **Zephyr** â€” Bright, energetic
- **Aoede** â€” Warm, expressive
- **Leda** â€” Youthful
- **Callirhoe**, **Autonoe**, **Despina**, **Erinome**, **Laomedeia**

## Appendix B: API Reference

### Google AI API Key
Get from: https://aistudio.google.com/apikey

### Telegram Bot Token
Get from: @BotFather on Telegram

### LangChain Gemini TTS Docs
https://python.langchain.com/docs/integrations/chat/google_generative_ai/